<div id="queue-box">
  <% form_remote_tag( :url => users_path, :method => :post ) do %>
    your name (to credit your queuings):<br/>
    <input type="text" name="username" value="<%= session[:username] %>"/>
    <input type="submit" value="set"/>
  <% end %>
  <p>
  logged in as: <%= session[:username].blank? ? "anonymous" : session[:username] %><br/>
  status: iTunes is <%= @state %> <br/>
  <% if @state != 'stopped' %>
    current playlist: <%= @iTunes.currentPlaylist.name %>
  <% end %>
  <% if @state == 'stopped' || @iTunes.currentPlaylist.name.strip != ITunes::QUEUE_PLAYLIST %>
    <br/><%= link_to_remote "start playing the queue (#{ITunes::QUEUE_PLAYLIST})", :url => {:controller => "queued_tracks", :action => "start_queue"},
    :loading => "$('queue-changing').show()", :complete => "$('queue-changing').hide()"  %>
  <% end %>
  </p>
  <div>
    <% form_remote_tag(:url => url_for({}), :method => :get ) do %>
    volume: 
      <%= text_field_tag "volume", @iTunes.soundVolume, {:size => 3} %>
      <%= submit_tag "change volume" %>
    <% end %>
  </div>

  <br/>
  <%= link_to_remote "skip to next", :url => {:controller => "queued_tracks", :action => "skip_current"},
      :loading => "$('queue-changing').show()", :complete => "$('queue-changing').hide()" %> 
  / <%= link_to_remote "pause/play", :url => {:controller => "queued_tracks", :action => "playpause"},
      :loading => "$('queue-changing').show()", :complete => "$('queue-changing').hide()"  %>
  / <%= link_to_remote "previous track", :url => {:controller => "queued_tracks", :action => "previous_track"},
      :loading => "$('queue-changing').show()", :complete => "$('queue-changing').hide()"  %>
  <p><%= link_to_remote "refresh queue info", :url => {:controller => "queued_tracks", :action => "reload_queue_box" },
      :loading => "$('queue-changing').show()", :complete => "$('queue-changing').hide()"  %>
  / <%= link_to_remote "toggle shuffle mode", :url => {:controller => "queued_tracks", :action => "toggle_shuffle" },
      :loading => "$('queue-changing').show()", :complete => "$('queue-changing').hide()"  %>
  <h2>queue
    <% if @iTunes.queue.shuffle == 1 %>
    <small>(in shuffle mode)</small>
    <% end %>
  </h2>
    
    <%= album_art_image_tag( @iTunes.artwork_file(@iTunes.currentTrack)) unless @state == "stopped" %>
  <% if @current_track_index == 0 %>
    <p>The playlist is finished playing</p>
  <% end %>
  <% if @queued_tracks.size > 0 %>
    <p><%= link_to_remote "clear the queue", :url => {:controller => "queued_tracks", :action => "clear" },
          :loading => "$('queue-changing').show()", :complete => "$('queue-changing').hide()" %></p>
  <% end %>

<table class="queue">
  <colgroup>
    <col style="width: 2em"/>
    <col style="width: 50%"/>
    <col />
  </colgroup>
  <thead>
    <th></th>
    <th>track</th>
    <th>queued by</th>
  </thead>
  <% @queued_tracks.reverse.each_with_index do |track, i| %>
  <% index = @queued_tracks.size - i - 1  %>
  <tr class="<%= cycle('odd', 'even') %> <%= (index + 1 == @current_track_index) ? 'current' : nil %>">
    <td>
      <%= index + 1 %>
      <br/>
      <%= link_to_remote "[x]", :url => { :controller => "queued_tracks", :action => :destroy, :id => index },
        :loading => "$('queue-changing').show()", :complete => "$('queue-changing').hide()"   %>
      <%= link_to_remote "pla", :url => { :controller => "queued_tracks", :action => :play_now, :id => index },
        :loading => "$('queue-changing').show()", :complete => "$('queue-changing').hide()"  %>
    </td>
    <td><%= track.artist %>
      <br/><%= track.name %> 
      <br/><%= track.album %>
    </td>
    <td>
      <%= track.comment %>
    </td>
  </tr>
<% end %>
</table>
</div>
